---
title: "sketch"
output: html_document
---

```{r}

library(tidyverse)

aprilBond %>% 
  mutate_at(vars(total, planned, tenure, coupon), as.numeric) %>% 
  mutate(code = str_extract(stocks, "[0-9]+(?=\\()")) %>% 
  mutate(code = case_when(
    nchar(code) == 4 ~ str_c(code, ".HK"),
    str_detect(code, "^6") ~ str_c(code, ".SH"),
    TRUE ~ str_c(code, ".SZ")
  )) %>% 
  # filter(lubridate::ymd(date) >= lubridate::ymd("2020-04-01")) %>% 
  mutate(stock_name = str_extract(stocks, "(?<=[0-9]{4,6}\\()[^\\(\\)]+(?=\\))")) %>% 
  select("name", "long_name", "stock_name") %>% 
  unique() %>% 
  writexl::write_xlsx("aprilnames.xlsx")
  
  
  
      group_by(stock_name, first) %>%
      summarise(n = n(), sum = sum(total)) %>% 
  filter(stock_name == "金融街") %>% 
  slice(1) %>% pull("sum") %>% paste0(., "亿")
  group_by(code, name) %>% 
  summarise(sum = sum(total, na.rm = TRUE)) %>% 
  drop_na() %>% 
  arrange(desc(sum))
  
  
```


```{r}

aprStock %>% semi_join(candidates, by = "stock_name")
```





```{r}

aprilBond %>% 
  filter(str_detect(name, "华"))
```















